import { Component, OnInit } from '@angular/core';
import { ServicioService } from '../servicios/servicio.service';
import Swal from 'sweetalert2';
import { FormBuilder, Validators } from '@angular/forms';

@Component({
  selector: 'app-proveedores',
  templateUrl: './proveedores.component.html',
  styleUrls: ['./proveedores.component.css']
})
export class ProveedoresComponent implements OnInit {
  tipo;
  proveedorForm;
  proveedores;
  mproveedor;
  proveedorForm1: any;
 proveedorbuscar;
 copia= true;
  public copia1 = false;
  public indice = true;
  public indice1 = false;

  constructor(private proveedorservicio: ServicioService, private formBuilder: FormBuilder) {
    this.proveedorForm = this.formBuilder.group({
      nombre_proveedor: '',
      ape_pat: ['', Validators.required],
      ape_mat: ['', Validators.required],
      rfc: ['', Validators.required],
      tipo: ['', Validators.required],
      telefono: ['', Validators.required],
      correo: ['', Validators.required],
      calle: ['', Validators.required],
      num_int: ['', Validators.required],
      num_ext: ['', Validators.required],
      colonia:  ['', Validators.required],
      cp:  ['', Validators.required],
      ciudad:  ['', Validators.required],
      estado:  ['', Validators.required],
      pais:  ['', Validators.required],
    });
   
   this.proveedorForm1 = this.formBuilder.group({
    id_proveedor:'',
    nombre_proveedor: '',
    ape_pat:'',
    ape_mat:'',
    rfc:'',
    tipo: '',
    telefono: '',
    correo: '',
    calle: '',
    num_int: '',
    num_ext: '',
    colonia: '',
    cp: '',
    ciudad: '',
    estado: '',
    pais: '',
  });
 }

  ngOnInit(): void {
    this.tipo = sessionStorage.getItem("tipo");
    this.getproveedor();
  }
  
  getproveedor(){
    this.proveedorservicio.getproveedores().subscribe(
      res =>{
        console.log(res);
        this.proveedores= res;
        this.proveedorbuscar=res;
      }
    );
  }
  applyFilter(filterValue: string) {
    let filterValueLower = filterValue.toLowerCase();
    if (filterValue === '') {
      this.proveedores = this.proveedorbuscar;
    } else {
      this.proveedores = this.proveedorbuscar.filter((proveedor: { id_proveedor: string | string[]; nombre: string; ape_pat: string; ape_mat: string; }) =>
      proveedor.id_proveedor.toString().includes(filterValueLower) ||
      proveedor.nombre.toLowerCase().includes(filterValueLower) ||
      proveedor.ape_pat.toLowerCase().includes(filterValueLower) ||
      proveedor.ape_mat.toLowerCase().includes(filterValueLower)
      );
    }
  }
  verproveedor(item :any){
    let proveedorID;
    proveedorID= item.id_proveedor;
    console.log(proveedorID);
    this.proveedorservicio.getproveedor(proveedorID).subscribe(res=>{
      console.log(res);
      this. mproveedor = res;
      this.proveedorForm1.setValue({
        id_proveedor:proveedorID,
        nombre_proveedor:this.mproveedor[0].nombre,
        ape_pat:this.mproveedor[0].ape_pat,
        ape_mat:this.mproveedor[0].ape_mat,
        rfc:this.mproveedor[0].rfc,
        tipo: this.mproveedor[0].tipo,
        telefono: this.mproveedor[0].telefono,
        correo: this.mproveedor[0].correo,
        calle: this.mproveedor[0].calle,
        num_int: this.mproveedor[0].num_int,
        num_ext: this.mproveedor[0].num_ext,
        colonia: this.mproveedor[0].colonia,
        cp:this.mproveedor[0].cp,
        ciudad:this.mproveedor[0].ciudad,
        estado: this.mproveedor[0].estado,
        pais: this.mproveedor[0].pais,
      });

    }
    );
  }
  
  newproveedor(){
   if (this.proveedorForm.valid) {
     this.proveedorservicio.addprovedor(this.proveedorForm.value).subscribe(res => {
      console.log(res);
     });
     Swal.fire("Proveedor agregado exitosamente");
     this.getproveedor();
   }
   else{
     Swal.fire("Campos Vacios");
     console.log(this.proveedorForm.valid);
     console.log(this.proveedorForm.value);
   }
  }
  borrar(){
    console.log(this.proveedorForm1.value);
    this.proveedorservicio.deletproveedor(this.proveedorForm1.value).subscribe(
      res => {
        console.log(res); 
      }
    );
    Swal.fire('Proveedor Eliminado Exitosamente');
  }
  editar(){
    console.log(this.proveedorForm1.value);
    this.proveedorservicio.editproveedor(this.proveedorForm1.value).subscribe(
      res => {
        console.log(res); 
      }
    );
    Swal.fire('Proveedor Actualizado Exitosamente');
  }

 


}